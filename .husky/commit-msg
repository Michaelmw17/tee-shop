#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Check for potentially sensitive information in commit message
commit_msg=$(cat "$1")

# Patterns to check for sensitive data
patterns=(
  "password"
  "secret"
  "key.*="
  "token"
  "api[_-]?key"
  "auth"
  "credentials"
)

echo "🔍 Scanning commit message for sensitive information..."

for pattern in "${patterns[@]}"; do
  if echo "$commit_msg" | grep -i -q "$pattern"; then
    echo "⚠️  WARNING: Commit message contains potentially sensitive keyword: '$pattern'"
    echo "📝 Commit message: $commit_msg"
    echo "❓ Are you sure you want to commit this? (y/N)"
    read -r response
    if [ "$response" != "y" ] && [ "$response" != "Y" ]; then
      echo "❌ Commit aborted for security reasons."
      exit 1
    fi
  fi
done

echo "✅ Commit message security check passed!"